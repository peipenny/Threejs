<!DOCTYPE html>
<html>
<head>
<style>
</style>
</head>
<body> 

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

<script>

var renderer,camera,scene,car;
var puck;

var raycaster;
var mouse = new THREE.Vector2();
var pickables = [];
var objects ;
var count=0 ;
var record=[];
var i =0;
var a = new THREE.Vector3();
var b = new THREE.Vector3();
var c = new THREE.Vector3();
var d = new THREE.Vector3();

init();
animate();

function init(){
	renderer = new THREE.WebGLRenderer({antialias:true});
	renderer.setSize (window.innerWidth,window.innerHeight);
	renderer.setClearColor(0x888888);
	document.body.appendChild(renderer.domElement);
	
	camera = new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1000);
	camera.position.z = 50; // (0,0,50)

	var controls = new THREE.OrbitControls(camera, renderer.domElement);

	scene = new THREE.Scene();
	var grid = new THREE.GridHelper(100,10,'red','white');
	scene.add(grid);
	
		///------light
	pointLight = new THREE.PointLight(0x404040,20,300);
	pointLight.position.set(100,50,100);
	scene.add(pointLight);
	
	object();
	

	//------------- touch
	
	objects = new THREE.Group();

	plane = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshBasicMaterial({
    transparent: true,
    opacity: 0.5,
    visible: true
	}));

	 scene.add(plane);
	 plane.rotation.x = -Math.PI / 2;
	 pickables = [plane];
	 
	 raycaster = new THREE.Raycaster();
	 document.addEventListener('pointerdown', onDocumentMouseDown, false);
	 //---------
	 
	 
}

function onDocumentMouseDown(event) {
	  event.preventDefault();
	  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
	  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

	  // find intersections
	  raycaster.setFromCamera(mouse, camera);
	  var intersects = raycaster.intersectObjects(pickables);
	  if (intersects.length > 0) {
		if(count!=4){
			count += 1;
			puck = new THREE.Mesh(new THREE.CylinderGeometry(5, 5, 2, 20), new THREE.MeshNormalMaterial());
			objects.add(puck);
			scene.add(puck);
			puck.position.copy(intersects[0].point);
			
			record[i++] = intersects[0].point;
			if(i==4){
				car.position.copy(intersects[0].point);
				a = record[0]; b=record[1]; c=record[2]; d=record[3];
			}
		}
	 }
}

function object(){
	//------------- car body
	var geometry1 = new THREE.BoxGeometry(6,4,4);
	var material = new THREE.MeshPhongMaterial({ color: 0xffffff});
	var body = new THREE.Mesh(geometry1,material);
	body.position.set(-3,2.6,2);
	//------------- car head 
	var shape = new THREE.Shape();
	shape.moveTo( 0,0 );
	shape.lineTo( 0,3.2 );
	shape.lineTo( 1.4, 3.2 );
	shape.lineTo( 1.55,2);
	shape.lineTo( 2.5,1.75);
	shape.lineTo( 2.5, 0 );

	var extrudeSettings = {
		steps: 4,
		depth: 2,
		bevelEnabled: true,
		bevelThickness: 1,
		bevelSize: 0,
		bevelOffset: 0,
		bevelSegments: 1
	};

	var geometry2 = new THREE.ExtrudeGeometry(shape, extrudeSettings);
	var material2 = new THREE.MeshPhongMaterial({ color: 0x2132ce});
	var head = new THREE.Mesh(geometry2,material2);
	head.position.set(0,0.6,1);

	var geometry3 = new THREE.CylinderGeometry(0.75,0.75,1,64);
	var material3 = new THREE.MeshPhongMaterial({ color: 0x000000});
	var tire1 = new THREE.Mesh(geometry3,material3);
	tire1.rotation.x=Math.PI/2;
	tire1.position.set(-4.5,0.5,3.51);

	var tire2 = tire1.clone();
	tire2.position.set(-4.5,0.5,0.45);
	var tire3 = tire1.clone();
	tire3.position.set(1,0.5,0.45);
	var tire4 = tire1.clone();
	tire4.position.set(1,0.5,3.51);
	
	car = new THREE.Object3D();
	car.add(tire1,tire2,tire3,tire4,body,head);

	scene.add(car);
	car.position.set(-50,0,-50);
}

var angle = 0;
var status = 3;

function animate(){

	if(status == 3) {

		car.position.set(car.position.x + (c.x-d.x)/50, 0, car.position.z + (c.z-d.z)/50);
		 if (car.position.x == c.x || car.position.z ==c.z) {
			status = 2;
		 }
	}
	
	renderer.render(scene,camera);
	requestAnimationFrame(animate);
}
	


</script>
</body>
</html>

